
<!-- saved from url=(0035)https://chriseth.github.io/qr-demo/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>QR Test</title>
<input type="file" accept="image/*" capture="camera" />
  <meta name="viewport" content="width=320, initial-scale=1">
</head>

<body style="margin: 0;">
  <h1>Live QR Decoder</h1>
<button onclick="scan()" >Scan QR Code</button>
<button onclick="stopScan()">Stop Scan</button>
  <div id="preview"><span>Error: Couldn't find enough finder patterns:0 patterns found</span></div>
  <div class="camera">
    <video id="video" width="320" height="240">Video stream not available.</video>
  </div>
  <canvas id="canvas" style="display: none;" width="320" height="240">
  </canvas>

  <script type="text/javascript" src="./QR Test_files/qrcode-reader.min.js"></script>

  <script type="text/javascript">
  var vidStream;
  function scan(){
    (function () {
      'use strict';

      var upload = document.getElementById('upload');
      var preview = document.getElementById('preview');
      var video = document.getElementById('video');
      var canvas = document.getElementById('canvas');
      navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then(function (stream) {
          video.srcObject = stream;
          vidStream = stream;
          video.muted = true;
          video.play();
        })
        .catch(function (err) {
          showResult(null, "An error occured! " + err);
        });
      var width = 320;    // We will scale the photo width to this
      var height = 0;     // This will be computed based on the input stream

      var streamingStarted = false;
      video.addEventListener('canplay', function (ev) {
        if (!streamingStarted) {
          height = video.videoHeight / (video.videoWidth / width);
          video.setAttribute('width', width);
          video.setAttribute('height', height);
          canvas.setAttribute('width', width);
          canvas.setAttribute('height', height);
          streamingStarted = true;
        }
      }, false);
      var scanInterval = window.setInterval(scanCode, 500);
      function scanCode() {
        if (width && height) {
          var context = canvas.getContext('2d');
          canvas.width = width;
          canvas.height = height;
          context.drawImage(video, 0, 0, width, height);
          qr.decode(canvas.toDataURL('image/png'));
        }
      }

      var qr = new QrCode();
      qr.callback = showResult;
      var codeFound = false;
      function showResult(result, err) {
        if (codeFound) {
          return;
        }
        var span = document.querySelector('span') || document.createElement('span');
        if (result) {
          span.textContent = result;
          codeFound = true;
          video.pause();
          window.clearInterval(scanInterval);
          alert(result);
        } else {
          span.textContent = 'Error: ' + err;
        }
        preview.appendChild(span);
      }
    })();}
function stopScan(){
video.pause();
video.src = "";
vidStream.getTracks()[0].stop();
}
  </script>


</body></html>
